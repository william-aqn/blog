---
layout: post
title: "Великий Китайский Файрвол"
description: "И как с ним работать"
tags: vpn
---
# Великий Китайский Файрвол
*За основу брал мануал <https://habr.com/ru/articles/735536/>*

Панель на сервере https://github.com/alireza0/x-ui
* Устанаваливаем
```bash
bash <(curl -Ls https://raw.githubusercontent.com/alireza0/x-ui/master/install.sh)
```

* Если хотим через докер
```bash
docker run -itd \
    -p 127.0.0.1:8181:54321 -p 443:443 -p 80:80 \
    -e XRAY_VMESS_AEAD_FORCED=false \
    -v $PWD/db/:/etc/x-ui/ \
    -v $PWD/cert/:/root/cert/ \
    --name x-ui --restart=unless-stopped \
    alireza7/x-ui:latest
```

# Основные моменты
* Стандартный логин/пароль - **admin**/**admin** меняем на свои
* В **X-UI** поле **Subscription** по умолчанию не отображается, нужно сначала активировать функционал подписок в настройках панели.
* По умолчанию заблокирован Торрент трафик, разрешаем в настройках.
* Делаем в настройках панели доступ только через 127.0.0.1

# Настройка Shadowsocks-2022
Создаем подключение:
* **Remark** - Любое название
* **Протокол** - Shadowsocks
* **Listening IP** - Оставляем пустым
* **Порт** - Панель выберет рандомный

Настраиваем пользователя, других можно добавить позже:
* **Email** - Любой текст
* **Subscription** - Тот же самый текст.

Дальше снова идут настройки протокола:
* **Шифрование** - выбираем что-нибудь что начинается с **2022**
* **Пароль** - (ключ) панель сгенерирует автоматически с правильной длиной для выбранного метода шифрования.

Нажимаем "Создать" и на этом настройка для Shadowsocks закончена, им уже можно пользоваться.


# Настройка VLESS с XTLS-Reality
Создаем подключение:
* **Remark** - Любое название
* **Протокол** - vless
* **Listening IP** - Оставляем пустым
* **Порт** - Обязательно **443**

Далее переходим к настройкам клиента:
* **Email** - Любой другой текст
* **Subscription** - Текст который указали при настройке в **Subscription** Shadowsocks-2022
* **Flow** - Выбираем "xtls-rprx-vision". *Поле **Flow** появится только после того, как чуть ниже поставите галочку на пункте **Reality***.

Дальше у нас идут настройки транспорта:
* **Reality** - Активно
* **XTLS** - Отключено
* **uTLS** - по умолчанию **firefox** (главное чтобы не **android**, могут быть проблемы с клиентами)
* **Домен** - Это не домен, а адрес для подключения к вашему серверу. Можно оставить пустым, тогда панель автоматически подставит IP-адрес или домен, по которому вы обращаетесь в панели на сервере.
* **ShortIds** - Случайное **hex** число
* **Public Key, Private Key** - Нажимаем **Get new keys**, и панель сама заполнит эти поля
* **Dest и Server names** - это самое интересное, это домен, под который вы будете маскироваться. По умолчанию панель предлагает маскировку под yahoo.com и www.yahoo.com с переадресацией на yahoo.com:443, но лучше выбрать какой-нибудь другой домен

# Клиенты
* Windows https://github.com/MatsuriDayo/nekoray/releases
    * Ядро выбираем sing-box
    * Тип подключения - VPN Mode
    * Настройка профиля
    ![Настройка nekobox](/assets/blog/shadow-reality/win-nekobox.png)
* Android https://github.com/MatsuriDayo/NekoBoxForAndroid/releases
  * https://4pda.to/forum/index.php?showtopic=1065786
* IOS https://apps.apple.com/us/app/shadowrocket/id932747118